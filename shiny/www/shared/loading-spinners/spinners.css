/*
  CSS for shiny.ui.loading_spinners module.

  The general idea is to leverage the `recalculating` class that shiny.js adds to each
  output when it's recalculating and do mainly two things:
  1. Add a background blur effect via a `::before` pseudo-element. This is a bit more
     subtle than just lowering the opacity and also doesn't affect the spinner itself.
  2. Add a spinner via a `::after` pseudo-element.
*/
.recalculating {
  position: relative;

  --_shiny-spinner-svg: var(--shiny-spinner-svg, url(tadpole-spinner.svg));
  --_shiny-spinner-color: var(
    --shiny-spinner-color,
    var(--bs-primary, #007bc2)
  );
  --_shiny-spinner-size: var(--shiny-spinner-size, 60px);
  --_shiny-spinner-easing: var(--shiny-spinner-easing, ease-in-out);
  --_shiny-spinner-speed: var(--shiny-spinner-speed, 2s);
  --_shiny-spinner-delay: var(--shiny-spinner-delay, 0.1s);
  --_shiny-spinner-animation: var(
    --shiny-spinner-animation,
    shiny-loading-spinner-spin
  );
}

/* 2. add the spinner (i.e., mask) */
.recalculating::after {
  position: absolute;
  inset: calc(50% - var(--_shiny-spinner-size) / 2);

  background: var(--_shiny-spinner-color);
  mask: var(--_shiny-spinner-svg) center/contain no-repeat;
  -webkit-mask: var(--_shiny-spinner-svg) center/contain no-repeat;
  width: var(--_shiny-spinner-size);
  height: var(--_shiny-spinner-size);
  content: "";

  scale: 0;
  animation-name: var(--_shiny-spinner-animation);
  animation-duration: var(--_shiny-spinner-speed);
  animation-iteration-count: infinite;
  animation-timing-function: var(--_shiny-spinner-easing);
  animation-delay: var(--_shiny-spinner-delay);

  z-index: 1001;
}

/*
  shiny.css puts `opacity: 0.3` on .recalculating, which would apply to the spinner
  which we don't want. So we move that opacity to non-spinner children.
*/
.recalculating {
  opacity: 1;
}
.recalculating > * {
  opacity: 0.3;
}
.recalculating::after {
  opacity: 1;
}

/* Opt-out class */
.disable-shiny-spinners .recalculating::after {
  display: none;
}

/* Keyframe that powers most spinner types */
@keyframes shiny-loading-spinner-spin {
  0% {
    scale: 1;
    rotate: 0deg;
  }
  100% {
    scale: 1;
    rotate: 360deg;
  }
}

/* For loading_spinners.settings(type="bounce") */
@keyframes shiny-loading-spinner-bounce {
  0% {
    animation-timing-function: cubic-bezier(0.33, 0, 0.66, 0.33);
    translate: 0 calc(var(--_shiny-spinner-size) * (5 / 24));
    scale: 1 1;
  }
  46.875% {
    translate: 0 calc(var(--_shiny-spinner-size) * (20 / 24));
    scale: 1 1;
  }
  50% {
    animation-timing-function: cubic-bezier(0.33, 0.66, 0.66, 1);
    translate: 0 calc(var(--_shiny-spinner-size) * (20.5 / 24));
    scale: 1.2 0.85;
  }
  53.125% {
    scale: 1 1;
  }
  100% {
    translate: 0 calc(var(--_shiny-spinner-size) * (5 / 24));
    scale: 1 1;
  }
}
